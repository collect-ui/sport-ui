{
  "tag": "layout-fit",
  "initStoreType": {
    "panelList": "panelList",
    "lastRightSsh": "contentReference"
  },
  "initStore": {
    "searchForm": {
      "search": ""
    },
    "panelList": [],
    "lastGroupId": "",
    "lastSubGroupId": "",
    "lastWebshellToken": "",
    "lastWebshellTitle": "",
    "panelKeyList": [],
    "subMap": {},
    "lastNewKey": "",
    "addNodeForm": {
      "type": "1",
      "server_env_id": null,
      "parent_id": null,
      "server_env_code": "",
      "server_env_name": "",
      "order_id": 0,
      "server_busi_name": "",
      "server_ip": "",
      "root_username": "",
      "root_password": "",
      "normal_username": "",
      "normal_password": ""
    },
    "updateNodeForm": {},
    "treeSelected": {
      "server_id": null,
      "server_env_id": null
    },
    "addNodeVisible": false,
    "nodeOp": "add",
    "server_env_data": [],
    "env_data": [],
    "loginVisible": false,
    "userList": [],
    "lastDblData": {},
    "last_webshell_token": "",
    "last_webshell_x": 0,
    "last_webshell_y": 0,
    "fileManageShow": false,
    "last_webshell_title": "",
    "fileInfoList": [],
    "current_dir": "",
    "lastRightSsh": [],
    "lastDownloadRowName": "",
    "downloadingPercent": 0
  },
  "initAction": [
    {
      "tag": "ajax",
      "group": "server-env-tree",
      "api": "post:/template_data/data?service=project.my_env_tree",
      "appendFormFields": "server-search-form",
      "adapt": {
        "server_env_data": "${data}"
      }
    },

    {
      "tag": "ajax",
      "enable": "${lastRightSsh.length>0}",
      "group": "reload-sftp-file",
      "api": "post:/template_data/data?service=webshell.get_dir_info_by_token",
      "appendFormFields": "webshell-file-manage",
      "data": {
        "token": "${lastRightSsh[0].token}"
      },
      "adapt": {
        "fileInfoList": "${data.dir}",
        "current_dir": "${data.current_dir}"
      }
    },
    {
      "tag":"handlerPath",
      "enable": "${lastRightSsh.length>0}",
      "path": "current_dir",
      "group": "reload-sftp-file"
    },
    {
      "tag": "arr-push",
      "description": "添加根路径",
      "enable": "${lastRightSsh.length>0 && current_dir!='/'}",
      "group": "reload-sftp-file",
      "from": "fileInfoList",
      "first": true,
      "value": {
        "name": "..",
        "is_dir": true
      }
    },
    {
      "tag": "update-form",
      "enable": "${lastRightSsh.length>0}",
      "group": "reload-sftp-file",
      "description": "根据结果设置表单路径",
      "formName": "webshell-file-manage",
      "value": {
        "path": "${current_dir}"
      }
    },
    {
      "tag": "method",
      "enable": "${lastRightSsh.length>0}",
      "group": "reload-sftp-file",
      "description": "设置右键对象路径",
      "method": "${lastRightSsh[0].setPath(current_dir)}"
    }
  ],
  "children": [
    {
      "tag": "layout",
      "children": [
        {
          "tag": "sider",
          "width": "320px",
          "className": "border-right",
          "theme": "light",
          "style": {
            "backgroundColor": "#fafafa"
          },
          "collapsible": true,
          "collapsedWidth": "40",
          "children": [
            {
              "tag": "layout-fit",
              "searchToolBar": [
                {
                  "tag": "form",
                  "name": "server-search-form",
                  "initialValues": "${searchForm}",
                  "layout": "inline",
                  "wrapperCol": {
                    "span": 24
                  },
                  "action": [
                    {
                      "tag": "reload-init-action",
                      "group": "server-env-tree",
                      "description": "查询"
                    }
                  ],
                  "submitOnChange": true,
                  "children": [
                    {
                      "tag": "form-item",
                      "style": {
                        "marginInlineEnd": "8px"
                      },
                      "children": [
                        {
                          "tag": "button",
                          "type": "primary",
                          "icon": "FaPlus",
                          "title": "新增节点",
                          "action": [
                            {
                              "tag": "update-store",
                              "value": {
                                "addNodeVisible": true
                              }
                            },
                            {
                              "tag": "reset-form",
                              "formName": "add-node-form"
                            },
                            {
                              "tag": "update-form",
                              "formName": "add-node-form",
                              "value": {
                                "parent_id": "${treeSelected.server_env_id}",
                                "server_env_id": "${treeSelected.server_env_id}",
                                "type": "${treeSelected.server_id?'2':'1'}"
                              }
                            },
                            {
                              "tag": "ajax",
                              "api": "post:/template_data/data?service=project.my_env",
                              "appendFormFields": "server-search-form",
                              "adapt": {
                                "env_data": "${data}"
                              }
                            }
                          ]
                        }
                      ]
                    },
                    {
                      "tag": "form-item",
                      "name": "search",
                      "className": "flex1",
                      "children": [
                        {
                          "tag": "input",
                          "placeholder": "IP/名称",
                          "allowClear": true
                        }
                      ]
                    }
                  ]
                }
              ],
              "children": [
                {
                  "tag": "tree",
                  "showLine": true,
                  "className": "h100",
                  "treeSelected": "${treeSelected}",
                  "showIcon": true,
                  "treeKey": "${item.server_id?item.server_id:item.server_env_id}",
                  "treeTitle": "${item.server_id?item.server_ip+'（'+item.server_busi_name+'）':item.server_env_name+'（'+item.server_env_code+'）'}",
                  "treeIcon": "${item.server_id?'DesktopOutlined':'FolderOutlined'}",
                  "treeData": "${server_env_data}",
                  "openLevel": 1,
                  "rightMenu": [
                    {
                      "type": "item",
                      "icon": "PlusOutlined",
                      "code": "add",
                      "label": "新增数据"
                    },
                    {
                      "type": "item",
                      "icon": "EditOutlined",
                      "code": "edit",
                      "label": "修改数据"
                    },
                    {
                      "type": "separator"
                    },
                    {
                      "type": "submenu",
                      "label": "其他",
                      "children": [
                        {
                          "type": "item",
                          "icon": "DeleteOutlined",
                          "code": "delete",
                          "label": "删除数据"
                        },
                        {
                          "type": "item",
                          "code": "history",
                          "icon": "HistoryOutlined",
                          "label": "操作记录"
                        }
                      ]
                    }
                  ],
                  "rightMenuAction": [
                    {
                      "tag": "reset-form",
                      "enable": "${['add','edit'].indexOf(item.code)>=0}",
                      "formName": "add-node-form"
                    },
                    {
                      "tag": "update-store",
                      "enable": "${item.code==='add'}",
                      "value": {
                        "addNodeVisible": true,
                        "nodeOp": "add",
                        "updateNodeForm": {}
                      }
                    },
                    {
                      "enable": "${item.code==='add'}",
                      "tag": "update-form",
                      "formName": "add-node-form",
                      "value": {
                        "parent_id": "${node.server_env_id}",
                        "server_env_id": "${node.server_env_id}",
                        "type": "${node.server_id?'2':'1'}"
                      }
                    },
                    {
                      "enable": "${item.code==='edit'}",
                      "tag": "update-form",
                      "formName": "add-node-form",
                      "value": {
                        "type": "${node.server_id?'2':'1'}"
                      }
                    },
                    {
                      "tag": "update-store",
                      "enable": "${item.code==='edit'}",
                      "value": {
                        "addNodeVisible": true,
                        "nodeOp": "edit",
                        "updateNodeForm": {}
                      }
                    },
                    {
                      "tag": "ajax",
                      "name": "查询环境信息",
                      "enable": "${item.code==='edit' && !node.server_id}",
                      "api": "post:/template_data/data?service=project.env_tree",
                      "data": {
                        "to_tree": false,
                        "server_env_id": "${node.server_env_id}",
                        "to_obj": true
                      },
                      "adapt": {
                        "updateNodeForm": "${data}"
                      }
                    },
                    {
                      "tag": "ajax",
                      "name": "查询服务器信息",
                      "enable": "${item.code==='edit' && node.server_id}",
                      "api": "post:/template_data/data?service=project.server_list",
                      "data": {
                        "server_id": "${node.server_id}",
                        "show_detail": true
                      },
                      "adapt": {
                        "updateNodeForm": "${data}"
                      }
                    },
                    {
                      "tag": "update-form",
                      "name": " 更新表单",
                      "enable": "${item.code==='edit'}",
                      "formName": "add-node-form",
                      "useStore": true,
                      "value": "${updateNodeForm}"
                    },
                    {
                      "tag": "check",
                      "enable": "${item.code=='delete' && !node.server_id}",
                      "title": "${'【'+node.server_env_name+'】下存在'+node?.children.length+'个节点，请先删除节点'}",
                      "check": "${!node.children || (node.children && node.children.length<=0)}"
                    },
                    {
                      "tag": "confirm",
                      "title": "确认提示",
                      "content": "${node.server_id?'确认删除所选【'+node.server_ip+'（'+node.server_busi_name+'）'+'】服务器吗？':'确认删除所选【'+node.server_env_name+'（'+node.server_env_code+'）'+'】环境吗'}",
                      "enable": "${item.code==='delete'}"
                    },
                    {
                      "tag": "ajax",
                      "name": "删除环境",
                      "enable": "${item.code=='delete' && !node.server_id}",
                      "group": "server-env-tree",
                      "api": "post:/template_data/data?service=project.server_env_delete",
                      "data": {
                        "server_env_id_list": "${[node.server_env_id]}"
                      }
                    },
                    {
                      "tag": "ajax",
                      "name": "删除服务器",
                      "enable": "${item.code=='delete' && node.server_id}",
                      "group": "server-env-tree",
                      "api": "post:/template_data/data?service=project.server_delete",
                      "data": {
                        "server_id_list": "${[node.server_id]}"
                      }
                    },
                    {
                      "tag": "reload-init-action",
                      "group": "server-env-tree",
                      "enable": "${item.code=='delete'}",
                      "description": "页面初始化请求"
                    },
                    {
                      "tag": "ajax",
                      "name": "增删改之后出发查询",
                      "enable": "${['add','edit','delete'].indexOf(item.code)>=0}",
                      "api": "post:/template_data/data?service=project.my_env",
                      "appendFormFields": "server-search-form",
                      "adapt": {
                        "env_data": "${data}"
                      }
                    }
                  ],
                  "dblAction": [
                    {
                      "tag": "update-store",
                      "description": "打开登陆框",
                      "enable": "${node.server_ip}",
                      "value": {
                        "loginVisible": true,
                        "lastDblData": "${node}"
                      }
                    },
                    {
                      "tag": "reset-form",
                      "enable": "${node.server_ip}",
                      "formName": "webshell-login-form"
                    },
                    {
                      "tag": "update-form",
                      "enable": "${node.server_ip}",
                      "formName": "webshell-login-form",
                      "value": {
                        "server_ip": "${lastDblData.server_env_name+'-'+lastDblData.server_ip+'（'+lastDblData.server_busi_name+'）'}"
                      }
                    },
                    {
                      "tag": "ajax",
                      "api": "post:/template_data/data?service=project.server_os_users_query",
                      "data": {
                        "server_id": "${lastDblData.server_id}"
                      },
                      "adapt": {
                        "userList": "${data}"
                      }
                    },
                    {
                      "tag": "update-form",
                      "enable": "${userList.length>0?true:false}",
                      "formName": "webshell-login-form",
                      "value": {
                        "server_os_users_id": "${userList[0].server_os_users_id}"
                      }
                    }
                  ]
                },
                {
                  "tag": "dialog",
                  "title": "${nodeOp==='add'?'新增节点':'修改节点'}",
                  "open": "${addNodeVisible}",
                  "action": [
                    {
                      "tag": "submit-form",
                      "formName": "add-node-form"
                    },
                    {
                      "tag": "ajax",
                      "name": "添加环境节点",
                      "enable": "${nodeOp==='add' && getFormValue('add-node-form','type')==='1'}",
                      "api": "post:/template_data/data?service=project.add_current_project_env",
                      "appendFormFields": "add-node-form"
                    },
                    {
                      "tag": "ajax",
                      "name": "修改环境节点",
                      "enable": "${nodeOp==='edit' && getFormValue('add-node-form','type')==='1'}",
                      "api": "post:/template_data/data?service=project.server_env_update",
                      "appendFormFields": "add-node-form",
                      "appendFields": "${updateNodeForm}"
                    },
                    {
                      "tag": "ajax",
                      "name": "添加服务器节点",
                      "enable": "${nodeOp==='add' && getFormValue('add-node-form','type')==='2'}",
                      "api": "post:/template_data/data?service=project.server_add",
                      "appendFormFields": "add-node-form"
                    },
                    {
                      "tag": "ajax",
                      "name": "修改服务器节点",
                      "enable": "${nodeOp==='edit' && getFormValue('add-node-form','type')==='2'}",
                      "api": "post:/template_data/data?service=project.server_modify",
                      "appendFormFields": "add-node-form",
                      "appendFields": "${updateNodeForm}"
                    },
                    {
                      "tag": "update-store",
                      "value": {
                        "addNodeVisible": false
                      }
                    },
                    {
                      "tag": "reload-init-action",
                      "group": "server-env-tree",
                      "description": "页面初始化请求"
                    }
                  ],
                  "children": [
                    {
                      "tag": "form",
                      "name": "add-node-form",
                      "initialValues": "${addNodeForm}",
                      "labelCol": {
                        "span": 4
                      },
                      "wrapperCol": {
                        "span": 20
                      },
                      "children": [
                        {
                          "tag": "form-item",
                          "name": "type",
                          "label": "类型",
                          "rules": [
                            {
                              "required": true,
                              "message": "请选择类型"
                            }
                          ],
                          "children": [
                            {
                              "tag": "select",
                              "disabled": "${nodeOp==='edit'}",
                              "placeholder": "请选择类型",
                              "options": [
                                {
                                  "value": "1",
                                  "label": "环境"
                                },
                                {
                                  "value": "2",
                                  "label": "服务器"
                                }
                              ]
                            }
                          ]
                        },
                        {
                          "tag": "form-item",
                          "noStyle": true,
                          "itemVisible": "${type==='1'}",
                          "children": [
                            {
                              "tag": "form-item",
                              "name": "parent_id",
                              "label": "上级",
                              "children": [
                                {
                                  "disabled": "${nodeOp==='edit'}",
                                  "tag": "tree-select",
                                  "placeholder": "请输入名称,不选为根节点",
                                  "allowClear": true,
                                  "treeIcon": "FolderOutlined",
                                  "treeLine": true,
                                  "openLevel": 2,
                                  "valueKey": "${item.server_env_id}",
                                  "treeTitle": "${item.server_env_name+'（'+item.server_env_code+'）'}",
                                  "showSearch": true,
                                  "showIcon": true,
                                  "treeData": "${env_data}"
                                }
                              ]
                            },
                            {
                              "tag": "form-item",
                              "label": "环境名称",
                              "name": "server_env_name",
                              "rules": [
                                {
                                  "required": true,
                                  "message": "环境名称不能为空"
                                }
                              ],
                              "children": [
                                {
                                  "tag": "input",
                                  "placeholder": "请输入环境名称"
                                }
                              ]
                            },
                            {
                              "tag": "form-item",
                              "label": "环境编码",
                              "name": "server_env_code",
                              "rules": [
                                {
                                  "required": true,
                                  "message": "环境编码不能为空"
                                }
                              ],
                              "children": [
                                {
                                  "tag": "input",
                                  "placeholder": "请输入环境编码"
                                }
                              ]
                            },
                            {
                              "tag": "form-item",
                              "label": "排序号",
                              "name": "order_id",
                              "rules": [
                                {
                                  "required": true,
                                  "message": "排序号不能为空"
                                }
                              ],
                              "children": [
                                {
                                  "tag": "input",
                                  "isNumber": true,
                                  "placeholder": "请输入排序号"
                                }
                              ]
                            }
                          ]
                        },
                        {
                          "tag": "form-item",
                          "noStyle": true,
                          "itemVisible": "${type==='2'}",
                          "children": [
                            {
                              "tag": "form-item",
                              "name": "server_env_id",
                              "label": "所属环境",
                              "rules": [
                                {
                                  "required": true,
                                  "message": "所属环境不能为空"
                                }
                              ],
                              "children": [
                                {
                                  "disabled": "${nodeOp==='edit'}",
                                  "tag": "tree-select",
                                  "placeholder": "请输入名称",
                                  "allowClear": true,
                                  "openLevel": 2,
                                  "valueKey": "${item.server_env_id}",
                                  "treeTitle": "${item.server_env_name+'（'+item.server_env_code+'）'}",
                                  "treeIcon": "FolderOutlined",
                                  "treeData": "${env_data}",
                                  "treeLine": true,
                                  "showIcon": true,
                                  "showSearch": true
                                }
                              ]
                            },
                            {
                              "tag": "form-item",
                              "name": "server_busi_name",
                              "label": "资源名称",
                              "rules": [
                                {
                                  "required": true,
                                  "message": "资源名称不能为空"
                                }
                              ],
                              "children": [
                                {
                                  "tag": "input",
                                  "placeholder": "请输入资源名称"
                                }
                              ]
                            },
                            {
                              "tag": "form-item",
                              "name": "server_ip",
                              "label": "服务器IP",
                              "rules": [
                                {
                                  "required": true,
                                  "message": "服务器IP不能为空"
                                }
                              ],
                              "children": [
                                {
                                  "tag": "input",
                                  "placeholder": "请输入服务器IP"
                                }
                              ]
                            },
                            {
                              "tag": "divider",
                              "orientation": "left",
                              "children": "管理员账号/密码"
                            },
                            {
                              "tag": "form-item",
                              "name": "root_username",
                              "label": "账号",
                              "rules": [
                                {
                                  "required": true,
                                  "message": "管理员账号不能为空"
                                }
                              ],
                              "children": [
                                {
                                  "tag": "input",
                                  "placeholder": "请输入管理员账号"
                                }
                              ]
                            },
                            {
                              "tag": "form-item",
                              "name": "root_password",
                              "label": "密码",
                              "rules": [
                                {
                                  "required": true,
                                  "message": "管理员密码不能为空"
                                }
                              ],
                              "children": [
                                {
                                  "tag": "input",
                                  "showPassword": true,
                                  "placeholder": "请输入管理员密码",
                                  "addonAfterIcon": "LoginOutlined",
                                  "addonAfterTitle": "登录测试",
                                  "addonAfterAction": [
                                    {
                                      "tag": "ajax",
                                      "api": "post:/template_data/data?service=project.server_info",
                                      "data": {
                                        "ip": "${getFormValue('add-node-form','server_ip')}",
                                        "username": "${getFormValue('add-node-form','root_username')}",
                                        "password": "${getFormValue('add-node-form','root_password')}"
                                      },
                                      "showResultMsg": true
                                    }
                                  ]
                                }
                              ]
                            },
                            {
                              "tag": "divider",
                              "orientation": "left",
                              "children": "普通账号/密码"
                            },
                            {
                              "tag": "form-item",
                              "name": "normal_username",
                              "label": "账号",
                              "children": [
                                {
                                  "tag": "input",
                                  "placeholder": "请输入普通账号"
                                }
                              ]
                            },
                            {
                              "tag": "form-item",
                              "name": "normal_password",
                              "label": "密码",
                              "children": [
                                {
                                  "tag": "input",
                                  "showPassword": true,
                                  "placeholder": "请输入普通密码",
                                  "addonAfterIcon": "LoginOutlined",
                                  "addonAfterTitle": "登录测试",
                                  "addonAfterAction": [
                                    {
                                      "tag": "ajax",
                                      "api": "post:/template_data/data?service=project.server_info",
                                      "data": {
                                        "ip": "${getFormValue('add-node-form','server_ip')}",
                                        "username": "${getFormValue('add-node-form','normal_username')}",
                                        "password": "${getFormValue('add-node-form','normal_password')}"
                                      },
                                      "showResultMsg": true
                                    }
                                  ]
                                }
                              ]
                            }
                          ]
                        }
                      ]
                    }
                  ]
                },
                {
                  "tag": "dialog",
                  "open": "${loginVisible}",
                  "title": "在线Shell登陆",
                  "action": [
                    {
                      "tag": "submit-form",
                      "formName": "webshell-login-form"
                    },
                    {
                      "tag": "ajax",
                      "api": "post:/template_data/data?service=webshell.gen_token",
                      "appendFormFields": "webshell-login-form",
                      "adapt": {
                        "last_webshell_token": "${data}"
                      }
                    },
                    {
                      "tag": "update-store",
                      "value": {
                        "loginVisible": false
                      }
                    },
                    {
                      "tag": "arr-push",
                      "description": "基于现有group新增webshell",
                      "enable": "${panelList.length>0}",
                      "from": "panelList",
                      "method": "${panelList[last_webshell_x].children[last_webshell_y].addChildren(value)} ",
                      "value": {
                        "token": "${last_webshell_token}",
                        "title": "${lastDblData.server_ip+'（'+lastDblData.server_busi_name+'）'}",
                        "path": "./"
                      }
                    },
                    {
                      "tag": "method",
                      "description": "执行激活标签方法",
                      "enable": "${panelList.length>0}",
                      "method": "${panelList[last_webshell_x].children[last_webshell_y].setActiveKey(last_webshell_token) }"
                    },
                    {
                      "tag": "arr-push",
                      "description": "添加新的group",
                      "enable": "${panelList.length<=0}",
                      "from": "panelList",
                      "value": {
                        "id": "${uuid()}",
                        "order": 1,
                        "description": "横向分组",
                        "children": [
                          {
                            "id": "${uuid()}",
                            "order": 1,
                            "description": "纵向分组",
                            "activeKey": "${last_webshell_token}",
                            "content": [
                              {
                                "path": "./",
                                "token": "${last_webshell_token}",
                                "title": "${lastDblData.server_ip+'（'+lastDblData.server_busi_name+'）'}"
                              }
                            ]
                          }
                        ]
                      }
                    },
                    {
                      "tag": "method",
                      "method": "${panelList.forEach(item=>item.initialize())}"
                    }
                  ],
                  "children": [
                    {
                      "tag": "form",
                      "name": "webshell-login-form",
                      "initialValues": {
                        "server_ip": "",
                        "server_os_users_id": null
                      },
                      "labelCol": {
                        "span": 4
                      },
                      "wrapperCol": {
                        "span": 20
                      },
                      "children": [
                        {
                          "tag": "form-item",
                          "name": "server_ip",
                          "label": "服务器",
                          "children": [
                            {
                              "tag": "input",
                              "placeholder": "请输入服务器IP",
                              "disabled": true
                            }
                          ]
                        },
                        {
                          "tag": "form-item",
                          "name": "server_os_users_id",
                          "label": "用户",
                          "rules": [
                            {
                              "required": true,
                              "message": "请选择用户"
                            }
                          ],
                          "children": [
                            {
                              "tag": "select",
                              "allowClear": true,
                              "fieldNames": {
                                "label": "user_name",
                                "value": "server_os_users_id"
                              },
                              "placeholder": "请选择用户",
                              "options": "${userList}"
                            }
                          ]
                        }
                      ]
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "tag": "content",
          "className": "webshell-container",
          "style": {
            "backgroundColor": "#fff",
            "display": "flex",
            "flexDirection": "column"
          },
          "children": [
            {
              "tag": "panel-group",
              "description": "外层水平分组",
              "direction": "horizontal",
              "children": [
                {
                  "tag": "listview",
                  "itemData": "${panelList}",
                  "keyField": "id",
                  "itemAttr": {
                    "tag": "panel",
                    "id": "${row.id}",
                    "minSize": 10,
                    "order": "${row.order}",
                    "className": "border-right",
                    "children": [
                      {
                        "tag": "panel-group",
                        "description": "里层上下分组",
                        "direction": "vertical",
                        "children": [
                          {
                            "tag": "listview",
                            "itemData": "${[...row.children]}",
                            "keyField": "id",
                            "itemAttr": {
                              "tag": "panel",
                              "id": "${row.id}",
                              "minSize": 10,
                              "order": "${row.order}",
                              "children": [
                                {
                                  "tag": "tabs",
                                  "size": "small",
                                  "type": "editable-card",
                                  "hideAdd": true,
                                  "itemAttr": {
                                    "label": "${row.title}",
                                    "children": [
                                      {
                                        "style": {
                                          "background": "#000",
                                          "color": "white"
                                        },
                                        "tag": "layout-fit",
                                        "children": [
                                          {
                                            "tag": "ssh",
                                            "token": "${row.token}"
                                          }
                                        ]
                                      }
                                    ]
                                  },
                                  "removeAction": [
                                    {
                                      "tag": "update-store",
                                      "description": "设置右键对象为空",
                                      "value": {
                                        "lastRightSsh": []
                                      }
                                    },
                                    {
                                      "tag": "method",
                                      "description": "关闭标签",
                                      "method": "${row.removeByKey(key)}"
                                    },
                                    {
                                      "tag": "method",
                                      "description": "如果关闭的标签是激活的标签，则激活标签往前移动一个",
                                      "enable": "${row.content.length>0 && row.activeKey==key}",
                                      "method": "${row.setActiveKey(row.content[row.content.length-1].token)}"
                                    },
                                    {
                                      "tag": "method",
                                      "method": "${panelList.filter(item=>item.checkNoneTab())}"
                                    },
                                    {
                                      "tag": "update-store",
                                      "value": {
                                        "panelList": "${panelList.filter(item=>item.children.length>0)}"
                                      }
                                    }
                                  ],
                                  "keyField": "token",
                                  "activeKey": "${row.activeKey}",
                                  "itemData": "${[...row.content]}",
                                  "rightMenu": [
                                    {
                                      "type": "item",
                                      "icon": "FaGripHorizontal",
                                      "code": "horizontal",
                                      "label": "水平分割"
                                    },
                                    {
                                      "type": "item",
                                      "icon": "FaGripVertical",
                                      "code": "vertical",
                                      "label": "垂直分割"
                                    },
                                    {
                                      "type": "item",
                                      "icon": "FaFolder",
                                      "code": "folder",
                                      "label": "文件管理",
                                      "action": [
                                        {
                                          "tag": "update-store",
                                          "description": "打开对话框",
                                          "value": {
                                            "fileInfoList": [],
                                            "fileManageShow": true,
                                            "lastRightSsh": "${[row]}"
                                          }
                                        },
                                        {
                                          "tag": "update-form",
                                          "enable": "${lastRightSsh.length>0}",
                                          "description": "设置表单路径",
                                          "formName": "webshell-file-manage",
                                          "value": {
                                            "path": "${lastRightSsh[0].path}"
                                          }
                                        },
                                        {
                                          "tag": "reload-init-action",
                                          "group": "reload-sftp-file"
                                        }
                                      ]
                                    }
                                  ],
                                  "rightMenuAction": [
                                    {
                                      "tag": "ajax",
                                      "enable": "${item.code==='horizontal'||item.code==='vertical'}",
                                      "api": "post:/template_data/data?service=webshell.gen_token_from_token",
                                      "data": {
                                        "token": "${row.token}"
                                      },
                                      "adapt": {
                                        "last_webshell_token": "${data}"
                                      }
                                    },
                                    {
                                      "tag": "arr-push",
                                      "description": "水平分割，添加数据",
                                      "enable": "${item.code==='horizontal'}",
                                      "from": "panelList",
                                      "value": {
                                        "id": "${uuid()}",
                                        "order": 1,
                                        "description": "横向分组",
                                        "children": [
                                          {
                                            "id": "${uuid()}",
                                            "order": 1,
                                            "description": "纵向分组",
                                            "activeKey": "${last_webshell_token}",
                                            "content": [
                                              {
                                                "token": "${last_webshell_token}",
                                                "title": "${row.title}",
                                                "path": "./"
                                              }
                                            ]
                                          }
                                        ]
                                      }
                                    },
                                    {
                                      "tag": "arr-push",
                                      "description": "垂直分割，添加数据",
                                      "enable": "${item.code==='vertical'}",
                                      "method": "${row.parent.parent.addChildren(value)}",
                                      "value": {
                                        "id": "${uuid()}",
                                        "order": 1,
                                        "description": "纵向分组",
                                        "activeKey": "${last_webshell_token}",
                                        "content": [
                                          {
                                            "token": "${last_webshell_token}",
                                            "title": "${row.title}",
                                            "path": "./"
                                          }
                                        ]
                                      }
                                    },
                                    {
                                      "tag": "method",
                                      "enable": "${item.code==='horizontal'||item.code==='vertical'}",
                                      "method": "${panelList.forEach(item=>item.initialize())}"
                                    }
                                  ]
                                }
                              ]
                            },
                            "joinAttr": {
                              "tag": "panel-resize"
                            }
                          }
                        ]
                      }
                    ]
                  },
                  "joinAttr": {
                    "tag": "panel-resize"
                  }
                }
              ]
            },
            {
              "tag": "dialog",
              "open": "${fileManageShow}",
              "width": "60%",
              "title": "${lastRightSsh.length>0?lastRightSsh[0].title+'-文件管理':'文件管理'}",
              "action": [
                {
                  "tag": "update-store",
                  "value": {
                    "fileManageShow": false
                  }
                }
              ],
              "children": [
                {
                  "tag": "layout-fit",
                  "searchToolBar": [
                    {
                      "tag": "form",
                      "layout": "inline",
                      "name": "webshell-file-manage",
                      "initialValues": {
                        "path": ""
                      },
                      "action": [

                        {
                          "tag": "reload-init-action",
                          "group": "reload-sftp-file"
                        }
                      ],
                      "submitOnEnter": true,
                      "children": [
                        {
                          "tag": "form-item",
                          "label": "路径",
                          "name": "path",
                          "style": {
                            "width": "400px",
                            "marginBottom": "10px"
                          },
                          "children": [
                            {
                              "tag": "input"
                            }
                          ]
                        },
                        {
                          "tag": "form-item",
                          "children": [
                            {
                              "tag": "button",
                              "htmlType": "submit",
                              "children": "刷新",
                              "action": [
                                {
                                  "tag": "reload-init-action",
                                  "group": "reload-sftp-file"
                                }
                              ]
                            },
                            {
                              "tag": "upload",
                              "style": {
                                "marginLeft": "30px"
                              },
                              "uploadConfig": {
                                "api": "post:/template_data/data?service=webshell.upload_file_by_token",
                                "data": {
                                  "token": "${lastRightSsh[0].token}",
                                  "path": "${lastRightSsh[0].path}"
                                }
                              },
                              "children": [
                                {
                                  "tag": "button",
                                  "children": "userCourseDetail"
                                }
                              ]
                            }

                          ]
                        }
                      ]
                    }
                  ],
                  "children": [
                    {
                      "tag": "table",
                      "style": {
                        "height": 500
                      },
                      "theme": "ag-theme-balham",
                      "headerHeight": 28,
                      "rowHeight": 26,
                      "rowData": "${fileInfoList}",
                      "columnDefs": [
                        {
                          "field": "name",
                          "headerName": "名称",
                          "minWidth": 120,
                          "flex": 1,
                          "cellRender": {
                            "tag": "span",
                            "children": [
                              {
                                "tag": "span",
                                "visible": "${!!row.is_dir}",
                                "action": [
                                  {
                                    "tag": "update-store",
                                    "value": {
                                      "current_dir": "${current_dir==='/'?'/'+row.name:current_dir+'/'+row.name}"
                                    }
                                  },
                                  {
                                    "tag": "method",
                                    "description": "设置对象路径",
                                    "method": "${lastRightSsh[0].setPath(current_dir)}"
                                  },
                                  {
                                    "tag": "update-form",
                                    "enable": "${lastRightSsh.length>0}",
                                    "description": "设置表单路径",
                                    "formName": "webshell-file-manage",
                                    "value": {
                                      "path": "${lastRightSsh[0].path}"
                                    }
                                  },
                                  {
                                    "tag": "reload-init-action",
                                    "group": "reload-sftp-file"
                                  }
                                ],
                                "className": "sftp-folder",
                                "children": [
                                  {
                                    "tag": "icon",
                                    "icon": "FolderOutlined",
                                    "style": {
                                      "margin": "2px 6px 2px 0px"
                                    }
                                  },
                                  {
                                    "tag": "span",
                                    "children": "${row.name}"
                                  }
                                ]
                              },
                              {
                                "tag": "span",
                                "visible": "${!row.is_dir}",
                                "style": {
                                  "margin": "2px 6px 2px 0px"
                                },
                                "children": [
                                  {
                                    "tag": "icon",
                                    "style": {
                                      "margin": "2px 6px"
                                    },
                                    "icon": "FileOutlined"
                                  },
                                  "${row.name}"
                                ]
                              }
                            ]
                          }
                        },
                        {
                          "field": "size_info",
                          "headerName": "大小",
                          "width": 160
                        },
                        {
                          "field": "is_dir",
                          "headerName": "类型",
                          "width": 160,
                          "cellRender": {
                            "tag": "span",
                            "children": "${row.is_dir?'文件夹':'文件'}"
                          }
                        },
                        {
                          "field": "modify_time",
                          "headerName": "修改时间",
                          "width": 160
                        },
                        {
                          "field": "",
                          "headerName": "操作",
                          "width": 180,
                          "suppressSizeToFit": true,
                          "pinned": "right",
                          "cellRender": {
                            "tag": "span",
                            "visible": "${!row.is_dir}",
                            "children": [
                              {
                                "tag": "progress",
                                "type":"circle" ,
                                "visible": "${lastDownloadRowName==row.name}",
                                "percent":"${downloadingPercent}",
                                "size":18
                              },
                              {
                                "tag": "button",
                                "type": "text",
                                "icon": "DownloadOutlined",
                                "size": "small",
                                "children": "下载",
                                "loading": "${lastDownloadRowName==row.name}",
                                "action": [
                                  {
                                    "tag": "ajax",
                                    "api": "post:/template_data/data?service=webshell.download_by_token",
                                    "download": true,
                                    "downloadingPercent": "${downloadingPercent}",
                                    "start": {
                                      "lastDownloadRowName": "${row.name}",
                                      "downloadingPercent": 0
                                    },
                                    "end":{
                                      "lastDownloadRowName": ""
                                    },
                                    "data": {
                                      "token": "${lastRightSsh[0].token}",
                                      "path": "${lastRightSsh[0].path+'/'+row.name}"
                                    }
                                  }
                                ]
                              },
                              {
                                "tag": "button",
                                "danger": true,
                                "type": "text",
                                "icon": "DeleteOutlined",
                                "confirm": {
                                  "title": "确认删除吗？",
                                  "description": "${'确认删除【'+row.name+'】文件吗'}"
                                },
                                "action": [
                                  {
                                    "tag": "ajax",
                                    "api": "post:/template_data/data?service=webshell.remove_file_by_token",
                                    "data": {
                                      "token": "${lastRightSsh[0].token}",
                                      "path": "${lastRightSsh[0].path+'/'+row.name}"
                                    }
                                  },
                                  {
                                    "tag": "reload-init-action",
                                    "group": "reload-sftp-file"
                                  }
                                ],
                                "size": "small",
                                "children": "删除"
                              }
                            ]
                          }
                        }
                      ]
                    }
                  ]
                }
              ]
            }
          ]
        }
      ]
    }
  ]
}
